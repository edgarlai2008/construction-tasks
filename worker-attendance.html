<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥äººå‡ºå‹¤è¨˜éŒ„ - Smart Worker Attendance</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; padding: 15px; color: #fff; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 15px; color: #00d4ff; font-size: 1.5em; }
        h2 { color: #ffa502; margin: 20px 0 10px 0; font-size: 1.2em; border-bottom: 2px solid #ffa502; padding-bottom: 5px; }
        .card { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; margin-bottom: 15px; backdrop-filter: blur(10px); }
        .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: all 0.3s; margin: 3px; }
        .btn-primary { background: linear-gradient(135deg, #00d4ff, #0099cc); color: #fff; }
        .btn-secondary { background: rgba(255,255,255,0.2); color: #fff; }
        .btn-danger { background: linear-gradient(135deg, #ff4757, #cc0022); color: #fff; }
        .btn-large { padding: 15px 25px; font-size: 1.1em; width: 100%; margin: 5px 0; }
        .selection-area { margin-top: 15px; }
        .selection-area label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        .selection-area select, .selection-area input { width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255,255,255,0.15); color: #fff; font-size: 1em; margin-bottom: 10px; }
        .selection-area select:focus, .selection-area input:focus { outline: none; background: rgba(255,255,255,0.25); }
        .work-item { background: rgba(255,165,2,0.2); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #ffa502; }
        .work-item .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .work-item .åˆ¤é ­ { color: #00d4ff; font-weight: bold; }
        .work-item .æ™‚é–“ { font-size: 0.8em; color: #aaa; }
        .work-item .ä½ç½® { margin: 5px 0; }
        .work-item .å…§å®¹ { font-size: 0.9em; color: #aaa; }
        .work-item .äººæ•¸ { font-size: 0.9em; color: #aaa; }
        .stats { background: rgba(0,212,255,0.2); padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
        .stats span { font-size: 1.5em; font-weight: bold; color: #00d4ff; }
        .action-bar { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .action-bar .btn { flex: 1; }
        .hidden { display: none !important; }
        .back-btn { background: rgba(255,255,255,0.1); color: #fff; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-bottom: 15px; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 5px; color: #aaa; font-size: 0.9em; }
        .pill-btn { display: inline-block; padding: 8px 15px; background: rgba(255,255,255,0.1); color: #fff; border: none; border-radius: 20px; cursor: pointer; margin: 3px; transition: all 0.3s; }
        .pill-btn:hover { background: rgba(255,255,255,0.2); }
        .pill-btn.selected { background: #00d4ff; color: #000; }
        .section-title { color: #ffa502; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .section-title span { font-size: 0.9em; font-weight: normal; color: #aaa; margin-left: auto; }
        .location-display { color: #00d4ff; font-weight: normal; margin-left: auto; }
        .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: #1a1a2e; padding: 20px; border-radius: 15px; max-width: 300px; width: 90%; }
        .modal h3 { margin-bottom: 15px; color: #00d4ff; }
        .modal .btn { width: 100%; margin-bottom: 10px; }
        .work-item-actions { margin-top: 10px; display: flex; gap: 5px; }
        .work-item-actions .btn { padding: 5px 10px; font-size: 0.8em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘· å·¥äººå‡ºå‹¤è¨˜éŒ„</h1>
        
        <div class="stats">
            ä»Šæ—¥ç¸½äººæ•¸: <span id="totalWorkers">0</span> äºº | 
            ä»Šæ—¥ç¸½é …ç›®: <span id="totalItems">0</span>
        </div>
        
        <div id="dateSelector" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; display: flex; align-items: center; flex-wrap: wrap; gap: 8px;">
        </div>
        
        <div class="action-bar">
            <button class="btn btn-primary" onclick="showAddForm()">â• æ–°å¢ç´€éŒ„</button>
            <button class="btn btn-secondary" onclick="generateReport()">ğŸ“‹ ç”Ÿæˆå ±å‘Š</button>
            <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
        </div>
        
        <!-- æ–°å¢è¡¨å–® -->
        <div id="addForm" class="card hidden">
            <button class="back-btn" onclick="hideAddForm()">â† è¿”å›</button>
            
            <!-- Location Selection Section -->
            <div id="locationSection" style="margin-top: 15px;">
                <div class="section-title" onclick="toggleLocationSection()">
                    <span>ğŸ“ å·¥ä½œä½ç½®</span>
                    <span id="currentLocationDisplay" class="location-display"></span>
                    <span id="locationToggleIcon">â–¼</span>
                </div>
                
                <!-- Step 1: Main Location -->
                <div id="step1" class="selection-area">
                    <label>æ€é¸å¤§å·¥ä½œä½ç½®</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;">
                        <button class="pill-btn" onclick="selectMainLocation('T9')">T9</button>
                        <button class="pill-btn" onclick="selectMainLocation('T9A')">T9A</button>
                        <button class="pill-btn" onclick="selectMainLocation('22A26A')">ç‡Ÿæ¥­éƒ¨22A26A</button>
                        <button class="pill-btn" onclick="selectMainLocation('SU')">SU</button>
                    </div>
                </div>
                
                <!-- Step 2: Start Floor -->
                <div id="step2" class="selection-area hidden">
                    <label>é–‹å§‹æ¨“å±¤ (å¿…é¸)</label>
                    <select id="startFloor" onchange="onStartFloorChange()">
                        <option value="">è«‹é¸æ“‡...</option>
                    </select>
                    <button class="btn btn-secondary" style="margin-top: 10px;" onclick="goToStep(1)">â† è¿”å›</button>
                </div>
                
                <!-- Step 3: End Floor -->
                <div id="step3" class="selection-area hidden">
                    <label>çµæŸæ¨“å±¤ (ç•™ç©ºå³åŒé–‹å§‹æ¨“å±¤ä¸€æ¨£)</label>
                    <select id="endFloor" onchange="onEndFloorChange()">
                        <option value="">åŒä¸Š (åªé¸ä¸€å±¤)</option>
                    </select>
                    <div id="currentFloorDiv" class="hidden" style="margin-top: 10px;">
                        <label>å‘¢å€‹ä¿‚é‚Šä¸€å±¤ï¼Ÿ</label>
                        <select id="currentFloor" onchange="onCurrentFloorChange()">
                            <option value="">è«‹é¸æ“‡...</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 10px;" onclick="goToStep(2)">â† è¿”å›</button>
                </div>
                
                <!-- Step 4: Sub Location -->
                <div id="step4" class="selection-area hidden">
                    <label>ç´°ç¯€</label>
                    <div id="subLocationButtons" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;"></div>
                    <button class="btn btn-secondary" style="margin-top: 10px;" onclick="goToStep(3)">â† è¿”å›</button>
                </div>
            </div>
            
            <!-- Work Content Section -->
            <div id="workSection" class="hidden">
                <div class="section-title">å·¥ä½œå…§å®¹</div>
                <div class="form-group">
                    <input type="text" id="workContent" placeholder="è¼¸å…¥å·¥ä½œå…§å®¹...">
                </div>
                
                <div class="section-title">åˆ¤é ­</div>
                <div class="form-group">
                    <select id="foreman">
                        <option value="">è«‹é¸æ“‡åˆ¤é ­...</option>
                        <option value="æŒ¯æº">æŒ¯æº</option>
                        <option value="ç›ˆåº·">ç›ˆåº·</option>
                        <option value="èšé¾">èšé¾</option>
                        <option value="å‰µåŸº">å‰µåŸº</option>
                        <option value="å‹è‰¯è¨˜">å‹è‰¯è¨˜</option>
                        <option value="æ—­æš‰">æ—­æš‰</option>
                        <option value="PHM">PHM</option>
                        <option value="ç”Ÿæ´»è‰²å½©">ç”Ÿæ´»è‰²å½©</option>
                        <option value="é æ±">é æ±</option>
                        <option value="æ’å®‰">æ’å®‰</option>
                        <option value="ç¾ç‰¹">ç¾ç‰¹</option>
                        <option value="æ–°é«˜">æ–°é«˜</option>
                        <option value="å˜‰è‡¨">å˜‰è‡¨</option>
                        <option value="æ·é”">æ·é”</option>
                        <option value="ä¿¡ç›Š">ä¿¡ç›Š</option>
                        <option value="è¯æ˜‡">è¯æ˜‡</option>
                        <option value="æ£®è¯">æ£®è¯</option>
                        <option value="è¥¿é–€å­">è¥¿é–€å­</option>
                        <option value="é‡‘ç£Š">é‡‘ç£Š</option>
                        <option value="æ•¸ç¢¼é€š">æ•¸ç¢¼é€š</option>
                    </select>
                </div>
                
                <div class="section-title">äººæ•¸</div>
                <div class="form-group">
                    <select id="workerCount" onchange="onWorkerCountChange()">
                        <option value="1">1äºº</option>
                        <option value="2">2äºº</option>
                        <option value="3">3äºº</option>
                        <option value="4">4äºº</option>
                        <option value="5">5äºº</option>
                        <option value="more">æ›´å¤š...</option>
                    </select>
                    <input type="number" id="moreWorkers" class="hidden" placeholder="è¼¸å…¥äººæ•¸" min="1" style="margin-top: 10px;">
                </div>
                
                <button class="btn btn-primary btn-large" style="margin-top: 15px;" onclick="addWork()">âœ… ç¢ºèªæ–°å¢</button>
                <button class="btn btn-secondary" style="margin-top: 15px;" onclick="resetToLocation()">é‡æ–°é¸æ“‡å·¥ä½œä½ç½®</button>
            </div>
        </div>
        
        <!-- è¨˜éŒ„åˆ—è¡¨ -->
        <div id="workList"></div>
        
        <!-- å ±å‘Šå€ -->
        <div id="reportArea" class="card hidden">
            <button class="back-btn" onclick="hideReport()">â† è¿”å›</button>
            <h3 style="color: #00d4ff; margin-bottom: 10px;">ğŸ“‹ å·¥äººå‡ºå‹¤å ±å‘Š</h3>
            <pre id="reportText" style="white-space: pre-wrap; font-size: 0.85em; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; overflow-x: auto;"></pre>
            <button class="btn btn-primary" onclick="copyReport()">ğŸ“‹ è¤‡è£½å ±å‘Š</button>
        </div>
    </div>
    
    <!-- é¸é …å½ˆçª— -->
    <div id="recordOptionsModal" class="modal">
        <div class="modal-content">
            <h3>é¸é …</h3>
            <button class="btn btn-primary" onclick="confirmEdit()">âœï¸ ä¿®æ”¹</button>
            <button class="btn btn-danger" onclick="confirmDelete()">ğŸ—‘ï¸ åˆªé™¤</button>
            <button class="btn btn-secondary" onclick="closeRecordOptions()">è¿”å›</button>
        </div>
    </div>

    <script>
        // Worker attendance data
        let records = JSON.parse(localStorage.getItem('workerRecords') || '[]');
        
        // Floor data
        const FLOOR_DATA = {
            'T9': {
                floors: ['ALL', '2', '3', '5', '6', '7', '8', '9', '10', '11', '12', '15', '16', '17', '18', '19', '20', '21', '22', '23', '25'],
                subLocations: { 'ALL': [], 'default': ['A', 'B', 'F'] }
            },
            'T9A': {
                floors: ['ALL', '2', '3', '5', '6', '7', '8', '9', '10', '11', '12', '15', '16', '17', '18', '19', '20', '21', '22', '23', '25', '26'],
                subLocations: {
                    '2': ['A', 'B', 'C', 'F'], '3': ['A', 'B', 'C', 'F'], '5': ['A', 'B', 'C', 'F'],
                    '6': ['A', 'B', 'C', 'F'], '7': ['A', 'B', 'C', 'F'], '8': ['A', 'B', 'C', 'F'],
                    '9': ['A', 'B', 'F'], '10': ['A', 'B', 'F'], '11': ['A', 'B', 'F'], '12': ['A', 'B', 'F'],
                    '15': ['A', 'B', 'F'], '16': ['A', 'B', 'F'], '17': ['A', 'B', 'F'], '18': ['A', 'B', 'F'],
                    '19': ['A', 'B', 'F'], '20': ['A', 'B', 'F'], '21': ['A', 'B', 'F'], '22': ['A', 'B', 'F'],
                    '23': ['A', 'B', 'F'], '25': ['A', 'B', 'F'], '26': ['A', 'B', 'F']
                }
            },
            '22A26A': {
                floors: ['22A', '26A', 'Both'],
                subLocations: ['Both', '22A', '26A']
            },
            'SU': {
                floors: ['27', '28'],
                subLocations: []
            }
        };
        
        let selectedDate = new Date().toISOString().split('T')[0];
        let currentSelection = {
            mainLocation: '',
            startFloor: '',
            endFloor: '',
            currentFloor: '',
            subLocation: ''
        };
        let currentRecordId = null;
        
        function saveRecords() {
            localStorage.setItem('workerRecords', JSON.stringify(records));
            renderRecords();
            renderDateSelector();
            updateStats();
        }
        
        function showAddForm() {
            document.getElementById('addForm').classList.remove('hidden');
            document.getElementById('reportArea').classList.add('hidden');
            toggleLocationSection();
            goToStep(1);
        }
        
        function hideAddForm() {
            document.getElementById('addForm').classList.add('hidden');
            resetForm();
        }
        
        function toggleLocationSection() {
            const section = document.getElementById('locationSection');
            const icon = document.getElementById('locationToggleIcon');
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                icon.textContent = 'â–²';
            } else {
                section.classList.add('hidden');
                icon.textContent = 'â–¼';
            }
        }
        
        function goToStep(step) {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            document.getElementById('step' + step).classList.remove('hidden');
        }
        
        function prepareSubLocation() {
            const div = document.getElementById('subLocationButtons');
            const loc = currentSelection.mainLocation;
            const floor = currentSelection.endFloor ? currentSelection.currentFloor : currentSelection.startFloor;
            
            let options = [];
            
            if (loc === 'T9') {
                options = ['A', 'B', 'F'];
            } else if (loc === 'T9A') {
                const floorNum = parseInt(floor);
                if (floorNum >= 2 && floorNum <= 8) {
                    options = ['A', 'B', 'C', 'F'];
                } else {
                    options = ['A', 'B', 'F'];
                }
            } else if (loc === '22A26A') {
                options = ['Both', '22A', '26A'];
            } else if (loc === 'SU') {
                currentSelection.subLocation = '';
                updateLocationDisplay();
                goToStep(5);
                document.getElementById('workSection').classList.remove('hidden');
                return;
            }
            
            div.innerHTML = options.map(o => 
                `<button class="pill-btn" onclick="selectSubLocation('${o}')">${o}</button>`
            ).join('');
        }
        
        function selectMainLocation(loc) {
            currentSelection.mainLocation = loc;
            currentSelection.startFloor = '';
            currentSelection.endFloor = '';
            currentSelection.currentFloor = '';
            currentSelection.subLocation = '';
            
            const floorSelect = document.getElementById('startFloor');
            floorSelect.innerHTML = '<option value="">è«‹é¸æ“‡...</option>';
            
            const floors = FLOOR_DATA[loc].floors;
            floors.forEach(f => {
                floorSelect.innerHTML += `<option value="${f}">${f}</option>`;
            });
            
            goToStep(2);
            updateLocationDisplay();
        }
        
        function onStartFloorChange() {
            currentSelection.startFloor = document.getElementById('startFloor').value;
            currentSelection.endFloor = '';
            currentSelection.currentFloor = '';
            currentSelection.subLocation = '';
            
            const endFloorSelect = document.getElementById('endFloor');
            endFloorSelect.innerHTML = '<option value="">åŒä¸Š (åªé¸ä¸€å±¤)</option>';
            
            const floors = FLOOR_DATA[currentSelection.mainLocation].floors;
            const startIndex = floors.indexOf(currentSelection.startFloor);
            
            if (startIndex < floors.length - 1) {
                for (let i = startIndex + 1; i < floors.length; i++) {
                    if (floors[i] !== 'ALL') {
                        endFloorSelect.innerHTML += `<option value="${floors[i]}">${floors[i]}</option>`;
                    }
                }
            }
            
            goToStep(3);
            updateLocationDisplay();
        }
        
        function onEndFloorChange() {
            currentSelection.endFloor = document.getElementById('endFloor').value;
            currentSelection.currentFloor = '';
            currentSelection.subLocation = '';
            
            const currentFloorDiv = document.getElementById('currentFloorDiv');
            const currentFloorSelect = document.getElementById('currentFloor');
            
            if (currentSelection.endFloor) {
                currentFloorDiv.classList.remove('hidden');
                currentFloorSelect.innerHTML = '<option value="">è«‹é¸æ“‡...</option>';
                
                const floors = FLOOR_DATA[currentSelection.mainLocation].floors;
                const startIndex = floors.indexOf(currentSelection.startFloor);
                const endIndex = floors.indexOf(currentSelection.endFloor);
                
                for (let i = startIndex; i <= endIndex; i++) {
                    currentFloorSelect.innerHTML += `<option value="${floors[i]}">${floors[i]}</option>`;
                }
            } else {
                currentFloorDiv.classList.add('hidden');
            }
            
            updateLocationDisplay();
        }
        
        function onCurrentFloorChange() {
            currentSelection.currentFloor = document.getElementById('currentFloor').value;
            updateLocationDisplay();
        }
        
        function selectSubLocation(sub) {
            currentSelection.subLocation = sub;
            updateLocationDisplay();
            goToStep(5);
            document.getElementById('workSection').classList.remove('hidden');
        }
        
        function updateLocationDisplay() {
            let display = currentSelection.mainLocation || '';
            
            if (currentSelection.startFloor) {
                display += ' ' + currentSelection.startFloor;
            }
            if (currentSelection.endFloor) {
                display += '-' + currentSelection.endFloor;
                if (currentSelection.currentFloor) {
                    display += ' (' + currentSelection.currentFloor + ')';
                }
            }
            if (currentSelection.subLocation) {
                display += ' ' + currentSelection.subLocation;
            }
            
            document.getElementById('currentLocationDisplay').textContent = display;
        }
        
        function resetToLocation() {
            document.getElementById('workSection').classList.add('hidden');
            currentSelection = {
                mainLocation: '',
                startFloor: '',
                endFloor: '',
                currentFloor: '',
                subLocation: ''
            };
            goToStep(1);
            updateLocationDisplay();
        }
        
        function onWorkerCountChange() {
            const moreInput = document.getElementById('moreWorkers');
            if (document.getElementById('workerCount').value === 'more') {
                moreInput.classList.remove('hidden');
            } else {
                moreInput.classList.add('hidden');
            }
        }
        
        function addWork() {
            const content = document.getElementById('workContent').value.trim();
            const foreman = document.getElementById('foreman').value;
            let count = document.getElementById('workerCount').value;
            
            if (!content) { alert('è«‹è¼¸å…¥å·¥ä½œå…§å®¹'); return; }
            if (!foreman) { alert('è«‹é¸æ“‡åˆ¤é ­'); return; }
            if (!currentSelection.mainLocation) { alert('è«‹é¸æ“‡å·¥ä½œä½ç½®'); return; }
            
            if (count === 'more') {
                count = document.getElementById('moreWorkers').value;
                if (!count || count < 1) { alert('è«‹è¼¸å…¥äººæ•¸'); return; }
            }
            
            let locationStr = currentSelection.mainLocation;
            if (currentSelection.startFloor) {
                locationStr += ' ' + currentSelection.startFloor;
            }
            if (currentSelection.endFloor) {
                locationStr += '-' + currentSelection.endFloor;
                if (currentSelection.currentFloor) {
                    locationStr += ' (' + currentSelection.currentFloor + ')';
                }
            }
            if (currentSelection.subLocation) {
                locationStr += ' ' + currentSelection.subLocation;
            }
            
            records.push({
                id: Date.now(),
                date: selectedDate,
                location: locationStr,
                content: content,
                foreman: foreman,
                count: parseInt(count),
                time: new Date().toLocaleTimeString('zh-HK', {hour:'2-digit',minute:'2-digit'})
            });
            
            saveRecords();
            resetToLocation();
            document.getElementById('workContent').value = '';
            document.getElementById('foreman').value = '';
            document.getElementById('workerCount').value = '1';
            document.getElementById('moreWorkers').value = '';
            document.getElementById('moreWorkers').classList.add('hidden');
            
            renderRecords();
            renderDateSelector();
            updateStats();
        }
        
        function showRecordOptions(id) {
            currentRecordId = id;
            document.getElementById('recordOptionsModal').style.display = 'flex';
        }
        
        function closeRecordOptions() {
            document.getElementById('recordOptionsModal').style.display = 'none';
            currentRecordId = null;
        }
        
        function confirmDelete() {
            if (currentRecordId) {
                if (confirm('ç¢ºå®šåˆªé™¤å‘¢é …ç´€éŒ„ï¼Ÿ')) {
                    records = records.filter(r => r.id !== currentRecordId);
                    saveRecords();
                }
            }
            closeRecordOptions();
        }
        
        function confirmEdit() {
            alert('ä¿®æ”¹åŠŸèƒ½é–‹ç™¼ä¸­...');
            closeRecordOptions();
        }
        
        function clearAll() {
            if (confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰ç´€éŒ„ï¼Ÿ')) {
                records = [];
                saveRecords();
            }
        }
        
        function renderRecords() {
            const list = document.getElementById('workList');
            const todayRecords = records.filter(r => r.date === selectedDate);
            
            if (todayRecords.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #666; padding: 30px;">æš«æ™‚æœªæœ‰è¨˜éŒ„ (é¸æ“‡å…¶ä»–æ—¥æœŸæŸ¥çœ‹)</div>';
                return;
            }
            
            // Group by foreman
            const byForeman = {};
            todayRecords.forEach(r => {
                if (!byForeman[r.foreman]) {
                    byForeman[r.foreman] = [];
                }
                byForeman[r.foreman].push(r);
            });
            
            // Sort foreman by count (most first)
            const sortedForemen = Object.keys(byForeman).sort((a, b) => byForeman[b].length - byForeman[a].length);
            
            list.innerHTML = sortedForemen.map(foreman => {
                const items = byForeman[foreman];
                const totalWorkers = items.reduce((sum, r) => sum + r.count, 0);
                
                return `
                <div class="work-item" style="border-left: 4px solid #00d4ff;">
                    <div class="header" onclick="editForemanGroup('${foreman}')" style="cursor: pointer;">
                        <span class="åˆ¤é ­">ğŸ‘· ${foreman}</span>
                        <span style="color: #ffa502; font-size: 1em; font-weight: bold; margin-left: 10px;">
                            ${totalWorkers}äºº
                        </span>
                    </div>
                    <div class="å…§å®¹" style="font-size: 0.9em; margin-top: 8px;">
                        ${items.map(r => `
                            <div style="padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                ${r.location} - ${r.content} 
                                <span style="color: #00d4ff;">${r.count}äºº</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="work-item-actions">
                        <button class="btn btn-secondary" onclick="showRecordOptions(${items[0].id})">è©³æƒ…</button>
                    </div>
                </div>
                `;
            }).join('');
        }
        
        function getDatesWithRecords() {
            const dates = new Set(records.map(r => r.date));
            return Array.from(dates).sort().reverse();
        }
        
        function renderDateSelector() {
            const dates = getDatesWithRecords();
            const selector = document.getElementById('dateSelector');
            
            let html = `
                <span style="color: #aaa; margin-right: 8px;">ğŸ“… æ—¥æœŸ:</span>
                <input type="date" id="recordDate" value="${selectedDate}" onchange="changeDate(this.value)" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px; border-radius: 4px;">
            `;
            
            if (dates.length > 0) {
                html += '<span style="color: #aaa; margin: 0 10px;">|</span>';
                dates.forEach(d => {
                    const isSelected = d === selectedDate;
                    const dateObj = new Date(d);
                    const dateStr = dateObj.toLocaleDateString('zh-HK', {month:'numeric', day:'numeric'});
                    html += `<button class="pill-btn ${isSelected ? 'selected' : ''}" onclick="changeDate('${d}')" style="background: ${isSelected ? '#00d4ff' : 'rgba(255,255,255,0.1)'}; color: ${isSelected ? '#000' : '#fff'}; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer;">${dateStr}</button>`;
                });
            }
            
            selector.innerHTML = html;
        }
        
        function changeDate(newDate) {
            selectedDate = newDate;
            saveRecords();
            renderRecords();
            renderDateSelector();
            updateStats();
        }
        
        function editForemanGroup(foreman) {
            if (confirm('ä½ æƒ³é»åš "${foreman}" æ—¢è¨˜éŒ„ï¼Ÿ\\n\\n[ç¢ºèª] - ç‡å“æ‰€æœ‰è¨˜éŒ„\\n[å–æ¶ˆ] - å””åšé‡')) {
                const foremanRecords = records.filter(r => r.foreman === foreman && r.date === selectedDate);
                if (foremanRecords.length > 0) {
                    alert('"${foreman}" æœ‰ ${foremanRecords.length}é …è¨˜éŒ„:\\n\\n' + 
                          foremanRecords.map(r => 'â€¢ ' + r.location + ' - ' + r.content + ' (' + r.count + 'äºº)').join('\\n'));
                }
            }
        }
        
        function updateStats() {
            const todayRecords = records.filter(r => r.date === selectedDate);
            const total = todayRecords.reduce((sum, r) => sum + r.count, 0);
            document.getElementById('totalWorkers').textContent = total;
            document.getElementById('totalItems').textContent = todayRecords.length;
        }
        
        function generateReport() {
            const today = new Date().toLocaleDateString('zh-HK', { month: 'numeric', day: 'numeric', weekday: 'short' });
            const weather = 'æ™´';
            
            const byForeman = {};
            records.filter(r => r.date === selectedDate).forEach(r => {
                if (!byForeman[r.foreman]) byForeman[r.foreman] = [];
                byForeman[r.foreman].push(r);
            });
            
            let report = `${today} ä¸Š(${weather})ä¸‹(${weather})\n`;
            report += `å·¥äºº${records.filter(r => r.date === selectedDate).reduce((s, r) => s + r.count, 0)}äºº\n\n`;
            
            const foremanOrder = ['æŒ¯æº', 'ç›ˆåº·', 'èšé¾', 'å‰µåŸº', 'å‹è‰¯è¨˜', 'æ—­æš‰', 'PHM', 'ç”Ÿæ´»è‰²å½©', 'é æ±', 'æ’å®‰', 'ç¾ç‰¹', 'æ–°é«˜', 'å˜‰è‡¨', 'æ·é”', 'ä¿¡ç›Š', 'è¯æ˜‡', 'æ£®è¯', 'è¥¿é–€å­', 'é‡‘ç£Š', 'æ•¸ç¢¼é€š'];
            
            foremanOrder.forEach(f => {
                if (byForeman[f]) {
                    report += `${f}\n`;
                    byForeman[f].forEach(r => {
                        report += `${r.location}  ${r.content}${r.count > 1 ? r.count + 'äºº' : ''}\n`;
                    });
                    report += '\n';
                }
            });
            
            document.getElementById('reportText').textContent = report;
            document.getElementById('reportArea').classList.remove('hidden');
            document.getElementById('addForm').classList.add('hidden');
        }
        
        function hideReport() {
            document.getElementById('reportArea').classList.add('hidden');
        }
        
        function copyReport() {
            const text = document.getElementById('reportText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('å ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            });
        }
        
        function resetForm() {
            currentSelection = {
                mainLocation: '',
                startFloor: '',
                endFloor: '',
                currentFloor: '',
                subLocation: ''
            };
            document.getElementById('workContent').value = '';
            document.getElementById('foreman').value = '';
            document.getElementById('workerCount').value = '1';
            document.getElementById('moreWorkers').value = '';
            document.getElementById('currentLocationDisplay').textContent = '';
        }
        
        // åˆå§‹åŒ–
        renderRecords();
        renderDateSelector();
        updateStats();
    </script>
</body>
</html>
